---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 06-map-many-eqtls.md in _episodes_rmd/
title: "Mapping Many Gene Expression Traits"
teaching: 30
exercises: 30
questions:
- "How do I map many genes?"
objectives:
- "To map several genes at the same time"
source: Rmd
---



### Load Libraries  


~~~
library(tidyverse)
library(knitr)
library(broom)
library(qtl2)
library(qtl2ggplot)
library(RColorBrewer)

source("../code/gg_transcriptome_map.R")
source("../code/qtl_heatmap.R")
~~~
{: .language-r}

Before we begin this lesson, we need to create another directory called `results` in our main directory.  You can do this by clicking on the "Files" tab and navigate into the main directory.  Then select "New Folder" and name it "results".

### Load Data


~~~
# expression data
load("../data/attie_DO500_expr.datasets.RData")

# data from paper
load("../data/dataset.islet.rnaseq.RData")

# phenotypes
load("../data/attie_DO500_clinical.phenotypes.RData")

# mapping data
load("../data/attie_DO500_mapping.data.RData")

# genotype probabilities
probs = readRDS("../data/attie_DO500_genoprobs_v5.rds")
~~~
{: .language-r}

### Data Selection

For this lesson, lets choose a random set of 50 gene expression phenotypes.




~~~
genes = colnames(norm)

sams <- sample(length(genes), 50, replace = FALSE, prob = NULL)
genes <- genes[sams]

gene.info <- dataset.islet.rnaseq$annots[genes,]
rownames = NULL
kable(gene.info)
~~~
{: .language-r}



|                   |gene_id            |symbol        |chr |      start|        end| strand|     middle|nearest.marker.id |biotype              |module        |hotspot |
|:------------------|:------------------|:-------------|:---|----------:|----------:|------:|----------:|:-----------------|:--------------------|:-------------|:-------|
|ENSMUSG00000028256 |ENSMUSG00000028256 |Odf2l         |3   | 145.118589| 145.153915|      1| 145.136252|3_145121769       |protein_coding       |green         |NA      |
|ENSMUSG00000021990 |ENSMUSG00000021990 |Spata13       |14  |  60.634001|  60.764556|      1|  60.699278|14_60705905       |protein_coding       |red           |NA      |
|ENSMUSG00000025195 |ENSMUSG00000025195 |Dnmbp         |19  |  43.847967|  43.912392|     -1|  43.880180|19_43877848       |protein_coding       |darkturquoise |NA      |
|ENSMUSG00000052056 |ENSMUSG00000052056 |Zfp217        |2   | 170.108643| 170.148103|     -1| 170.128373|2_170118266       |protein_coding       |magenta       |NA      |
|ENSMUSG00000090487 |ENSMUSG00000090487 |Gm2888        |14  |   3.030002|   3.038762|      1|   3.034382|14_3040840        |protein_coding       |plum1         |NA      |
|ENSMUSG00000019772 |ENSMUSG00000019772 |Vip           |10  |   5.639218|   5.647614|      1|   5.643416|10_5637668        |protein_coding       |paleturquoise |NA      |
|ENSMUSG00000045114 |ENSMUSG00000045114 |Prrt2         |7   | 127.016771| 127.021211|     -1| 127.018991|7_127066421       |protein_coding       |grey          |NA      |
|ENSMUSG00000097203 |ENSMUSG00000097203 |4732419C18Rik |8   | 123.744631| 123.754228|     -1| 123.749430|8_123694905       |lincRNA              |greenyellow   |NA      |
|ENSMUSG00000042508 |ENSMUSG00000042508 |Dmtf1         |5   |   9.118801|   9.161776|     -1|   9.140288|5_9151068         |protein_coding       |brown         |NA      |
|ENSMUSG00000023025 |ENSMUSG00000023025 |Larp4         |15  |  99.970074| 100.016351|      1|  99.993212|15_100012596      |protein_coding       |darkgreen     |NA      |
|ENSMUSG00000064263 |ENSMUSG00000064263 |Gm1631        |2   |  71.719417|  71.730966|      1|  71.725192|2_71683802        |protein_coding       |grey          |NA      |
|ENSMUSG00000083011 |ENSMUSG00000083011 |Gm12816       |4   | 112.955075| 112.956286|     -1| 112.955680|4_112905586       |pseudogene           |grey          |NA      |
|ENSMUSG00000083339 |ENSMUSG00000083339 |Gm11693       |11  | 113.678530| 113.679331|      1| 113.678930|11_113679730      |pseudogene           |grey          |NA      |
|ENSMUSG00000081929 |ENSMUSG00000081929 |Rps11-ps2     |11  | 116.382750| 116.383205|      1| 116.382978|11_116377446      |pseudogene           |grey          |NA      |
|ENSMUSG00000090555 |ENSMUSG00000090555 |Gm8893        |12  | 103.817856| 103.822243|     -1| 103.820050|12_103826618      |pseudogene           |grey          |NA      |
|ENSMUSG00000006019 |ENSMUSG00000006019 |Dhx34         |7   |  16.197147|  16.222037|     -1|  16.209592|7_16210236        |protein_coding       |black         |NA      |
|ENSMUSG00000078601 |ENSMUSG00000078601 |Gm12525       |3   | 108.361551| 108.362256|      1| 108.361904|3_108353179       |antisense            |grey          |NA      |
|ENSMUSG00000078952 |ENSMUSG00000078952 |Gm2373        |13  |  97.434970|  97.497007|      1|  97.465988|13_97466637       |lincRNA              |grey          |NA      |
|ENSMUSG00000018845 |ENSMUSG00000018845 |Unc45b        |11  |  82.910550|  82.943403|      1|  82.926976|11_82833747       |protein_coding       |grey          |NA      |
|ENSMUSG00000028137 |ENSMUSG00000028137 |Celf3         |3   |  94.478831|  94.492193|      1|  94.485512|3_94429795        |protein_coding       |black         |NA      |
|ENSMUSG00000031270 |ENSMUSG00000031270 |4930513O06Rik |X   | 139.086243| 139.093405|      1| 139.089824|X_139084893       |protein_coding       |brown         |NA      |
|ENSMUSG00000091423 |ENSMUSG00000091423 |Gm17509       |13  | 117.218701| 117.221075|     -1| 117.219888|13_117256471      |protein_coding       |grey          |NA      |
|ENSMUSG00000070304 |ENSMUSG00000070304 |Scn2b         |9   |  45.117876|  45.130070|      1|  45.123973|9_45128094        |protein_coding       |grey          |NA      |
|ENSMUSG00000019820 |ENSMUSG00000019820 |Utrn          |10  |  12.382188|  12.861735|     -1|  12.621962|10_12635805       |protein_coding       |saddlebrown   |NA      |
|ENSMUSG00000062753 |ENSMUSG00000062753 |AI413582      |17  |  27.563575|  27.565749|     -1|  27.564662|17_27566804       |protein_coding       |red           |NA      |
|ENSMUSG00000057672 |ENSMUSG00000057672 |Pkn1          |8   |  83.669762|  83.699179|     -1|  83.684470|8_83587702        |protein_coding       |black         |NA      |
|ENSMUSG00000095601 |ENSMUSG00000095601 |Gm21085       |X   |  37.380028|  37.384493|      1|  37.382260|X_37366530        |protein_coding       |grey          |NA      |
|ENSMUSG00000086794 |ENSMUSG00000086794 |Gm11642       |11  | 103.723950| 103.724532|      1| 103.724241|11_103724029      |processed_transcript |grey          |NA      |
|ENSMUSG00000060467 |ENSMUSG00000060467 |Gm10080       |9   |  44.374595|  44.375209|     -1|  44.374902|9_44362716        |pseudogene           |grey          |NA      |
|ENSMUSG00000022174 |ENSMUSG00000022174 |Dad1          |14  |  54.235479|  54.254104|     -1|  54.244792|14_54244226       |protein_coding       |blue          |NA      |
|ENSMUSG00000020170 |ENSMUSG00000020170 |Frs2          |10  | 117.070129| 117.148474|     -1| 117.109302|10_117122171      |protein_coding       |saddlebrown   |NA      |
|ENSMUSG00000029512 |ENSMUSG00000029512 |Ulk1          |5   | 110.784488| 110.810097|     -1| 110.797292|5_110843597       |protein_coding       |yellow        |NA      |
|ENSMUSG00000000296 |ENSMUSG00000000296 |Tpd52l1       |10  |  31.332380|  31.445921|     -1|  31.389150|10_31301766       |protein_coding       |brown         |NA      |
|ENSMUSG00000039233 |ENSMUSG00000039233 |Tbce          |13  |  13.997949|  14.039638|     -1|  14.018794|13_14120641       |protein_coding       |grey          |NA      |
|ENSMUSG00000027361 |ENSMUSG00000027361 |Gabpb1        |2   | 126.627442| 126.676337|     -1| 126.651890|2_126678042       |protein_coding       |turquoise     |NA      |
|ENSMUSG00000029780 |ENSMUSG00000029780 |Nt5c3         |6   |  56.882400|  56.923932|     -1|  56.903166|6_56826266        |protein_coding       |magenta       |NA      |
|ENSMUSG00000030324 |ENSMUSG00000030324 |Rho           |6   | 115.931927| 115.938829|      1| 115.935378|6_116075585       |protein_coding       |darkred       |NA      |
|ENSMUSG00000052423 |ENSMUSG00000052423 |B4galt3       |1   | 171.270328| 171.276896|      1| 171.273612|1_171295194       |protein_coding       |black         |NA      |
|ENSMUSG00000096370 |ENSMUSG00000096370 |Gm21992       |19  |   4.742913|   4.811612|     -1|   4.777262|19_4628265        |protein_coding       |blue          |NA      |
|ENSMUSG00000000056 |ENSMUSG00000000056 |Narf          |11  | 121.237253| 121.255856|      1| 121.246554|11_121200487      |protein_coding       |brown         |NA      |
|ENSMUSG00000046167 |ENSMUSG00000046167 |Gldn          |9   |  54.286486|  54.341786|      1|  54.314136|9_54291137        |protein_coding       |grey          |NA      |
|ENSMUSG00000062044 |ENSMUSG00000062044 |Lmtk3         |7   |  45.783738|  45.804144|      1|  45.793941|7_45720922        |protein_coding       |yellow        |NA      |
|ENSMUSG00000046719 |ENSMUSG00000046719 |Nxph3         |11  |  95.509845|  95.514570|     -1|  95.512208|11_95489858       |protein_coding       |red           |NA      |
|ENSMUSG00000079639 |ENSMUSG00000079639 |Rhox4a        |X   |  37.265338|  37.270136|      1|  37.267737|X_37171167        |protein_coding       |grey          |NA      |
|ENSMUSG00000052392 |ENSMUSG00000052392 |Acot4         |12  |  84.038379|  84.044723|      1|  84.041551|12_84015575       |protein_coding       |grey          |chr2    |
|ENSMUSG00000083483 |ENSMUSG00000083483 |Gm14044       |2   | 130.384883| 130.385329|     -1| 130.385106|2_130349094       |pseudogene           |grey          |NA      |
|ENSMUSG00000078932 |ENSMUSG00000078932 |CN725425      |15  |  91.231578|  91.260885|      1|  91.246232|15_91251706       |protein_coding       |grey          |NA      |
|ENSMUSG00000074796 |ENSMUSG00000074796 |Slc4a11       |2   | 130.684113| 130.697519|     -1| 130.690816|2_130559955       |protein_coding       |red           |NA      |
|ENSMUSG00000084221 |ENSMUSG00000084221 |Hmgb1-ps4     |19  |   6.592602|   6.593236|     -1|   6.592919|19_6545203        |pseudogene           |grey          |NA      |
|ENSMUSG00000028270 |ENSMUSG00000028270 |Gbp2          |3   | 142.620602| 142.638008|      1| 142.629305|3_142705784       |protein_coding       |magenta       |NA      |

### Expression Data

Lets check the distribution for the first 20 gene expression phenotypes. If you would like to check the distribution of all 50 genes, change `for(gene in genes[1:20])` in the code below to `for(gene in genes)`.


~~~
par(mfrow=c(3,4))
for(gene in genes[1:20]){
  hist(norm[,gene], main = gene)
  }
~~~
{: .language-r}

<img src="../fig/rmd-06-hist_untransformed-1.png" alt="plot of chunk hist_untransformed" width="612" style="display: block; margin: auto;" /><img src="../fig/rmd-06-hist_untransformed-2.png" alt="plot of chunk hist_untransformed" width="612" style="display: block; margin: auto;" />
The histogram indicates that distribution of these counts are normalised (as they should be).

### The Marker Map  

We are using the same marker map as in the previous [lesson](https://smcclatchy.github.io/gene-expression-qtl/04-review-mapping-steps/index.html#the-marker-map)


### Genotype probabilities  

We have explored this earlier in th previous [lesson](https://smcclatchy.github.io/gene-expression-qtl/04-review-mapping-steps/index.html#genotype-probabilities).  But, as a reminder, we have already calculated genotype probabilities which we loaded above called `probs`.  This contains the 8 state genotype probabilities using the 69k grid  map of the same 500 DO mice that also have clinical phenotypes. 


### [Kinship Matrix](https://smcclatchy.github.io/mapping/04-calc-kinship/)

We have explored the kinship matrix in the previous [lesson](https://smcclatchy.github.io/gene-expression-qtl/04-review-mapping-steps/index.html#kinship-matrix). It has already been calculated and loaded in above. 


### Covariates    

Now let's add the necessary covariates. For these 50 gene expression data, let's see which covariates are significant.


~~~
###merging covariate data and expression data to test for sex, wave and diet_days.

cov.counts <- merge(covar, norm[,genes], by=c("row.names"), sort=F)

#testing covairates on expression data

tmp = cov.counts %>%
        dplyr::select(mouse, sex, DOwave, diet_days, names(cov.counts[,genes])) %>%
        gather(expression, value, -mouse, -sex, -DOwave, -diet_days) %>%
        group_by(expression) %>%
        nest()
mod_fxn = function(df) {
  lm(value ~ sex + DOwave + diet_days, data = df)
}
tmp = tmp %>%
  mutate(model = map(data, mod_fxn)) %>%
  mutate(summ = map(model, tidy)) %>%
  unnest(summ) 
#  kable(tmp, caption = "Effects of Sex, Wave & Diet Days on Expression")

tmp
~~~
{: .language-r}



~~~
# A tibble: 200 × 8
# Groups:   expression [50]
   expression         data     model  term     estimate std.e…¹ stati…²  p.value
   <chr>              <list>   <list> <chr>       <dbl>   <dbl>   <dbl>    <dbl>
 1 ENSMUSG00000028256 <tibble> <lm>   (Interc…  0.459   0.491     0.935 3.51e- 1
 2 ENSMUSG00000028256 <tibble> <lm>   sexM     -0.0991  0.0801   -1.24  2.17e- 1
 3 ENSMUSG00000028256 <tibble> <lm>   DOwave   -0.542   0.0360  -15.0   2.47e-40
 4 ENSMUSG00000028256 <tibble> <lm>   diet_da…  0.00740 0.00375   1.97  4.95e- 2
 5 ENSMUSG00000021990 <tibble> <lm>   (Interc…  0.818   0.607     1.35  1.79e- 1
 6 ENSMUSG00000021990 <tibble> <lm>   sexM     -0.302   0.0989   -3.05  2.43e- 3
 7 ENSMUSG00000021990 <tibble> <lm>   DOwave    0.0281  0.0445    0.631 5.28e- 1
 8 ENSMUSG00000021990 <tibble> <lm>   diet_da… -0.00574 0.00464  -1.24  2.17e- 1
 9 ENSMUSG00000025195 <tibble> <lm>   (Interc… -1.80    0.551    -3.27  1.19e- 3
10 ENSMUSG00000025195 <tibble> <lm>   sexM      0.188   0.0898    2.09  3.73e- 2
# … with 190 more rows, and abbreviated variable names ¹​std.error, ²​statistic
~~~
{: .output}



~~~
tmp %>%
  filter(term != "(Intercept)") %>%
  mutate(neg.log.p = -log10(p.value)) %>%
  ggplot(aes(term, neg.log.p)) +
    geom_point() +
    facet_wrap(~expression, ncol=10) +
    labs(title = "Significance of Sex, Wave & Diet Days on Expression") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
rm(tmp)
~~~
{: .language-r}

<img src="../fig/rmd-06-covariates_sig-1.png" alt="plot of chunk covariates_sig" width="612" style="display: block; margin: auto;" />

We can see that `DOwave` is the most significant.  However, given that a few are influenced by `sex` and `diet_days`, we will have to correct for those as well. 



~~~
# convert sex and DO wave (batch) to factors
pheno_clin$sex = factor(pheno_clin$sex)
pheno_clin$DOwave = factor(pheno_clin$DOwave)
pheno_clin$diet_days = factor(pheno_clin$DOwave)

covar = model.matrix(~sex + DOwave + diet_days, data = pheno_clin)
~~~
{: .language-r}

### [Performing a genome scan](https://smcclatchy.github.io/mapping/06-perform-genome-scan/) 

Now lets perform the genome scan!  We are also going to save our qtl results in an `Rdata` file to be used in further lessons. 

### QTL Scans


~~~
qtl.file = "../results/gene.norm_qtl_cis.trans.Rdata"

if(file.exists(qtl.file)) {
  load(qtl.file)
  } else {
    qtl = scan1(genoprobs = probs, 
                pheno = norm[,genes, drop = FALSE],
                kinship = K, 
                addcovar = covar, 
                cores = 2)
    save(qtl, file = qtl.file)
    }
~~~
{: .language-r}

### QTL plots

Let's plot the first 20 gene expression phenotypes.  If you would like to plot all 50, change `for(i in 1:20)` in the code below to `for(i in 1:ncol(qtl))`.




~~~
par(mfrow=c(3,4))
for(i in 1:20) {
  plot_scan1(x = qtl, 
             map = map, 
             lodcolumn = i, 
             main = colnames(qtl)[i])
  abline(h = 6, col = 2, lwd = 2)
  }
~~~
{: .language-r}

<img src="../fig/rmd-06-qtl_plots-1.png" alt="plot of chunk qtl_plots" width="612" style="display: block; margin: auto;" /><img src="../fig/rmd-06-qtl_plots-2.png" alt="plot of chunk qtl_plots" width="612" style="display: block; margin: auto;" />

### QTL Peaks

We are also going to save our peak results so we can use these again else where.  First, lets get out peaks with a LOD score greater than 6. 


~~~
lod_threshold = 6
peaks = find_peaks(scan1_output = qtl, 
                   map = map, 
                   threshold = lod_threshold, 
                   peakdrop = 4, 
                   prob = 0.95)
~~~
{: .language-r}

We will save these peaks into a csv file. 


~~~
kable(peaks %>% 
        dplyr::select(-lodindex) %>% 
        arrange(chr, pos), caption = "Expression QTL (eQTL) Peaks with LOD >= 6")

write_csv(peaks, "../results/gene.norm_qtl_peaks_cis.trans.csv")
~~~
{: .language-r}


Table: Phenotype QTL Peaks with LOD >= 6

|lodcolumn          |chr |        pos|        lod|      ci_lo|     ci_hi|
|:------------------|:---|----------:|----------:|----------:|---------:|
|ENSMUSG00000033389 |1   |  24.116007|   6.296328|  18.001823|  32.48454|
|ENSMUSG00000041189 |1   |  38.681019|   8.009293|  37.690607|  38.99625|
|ENSMUSG00000015112 |1   |  74.157715|   6.390019|  73.792993| 190.01604|
|ENSMUSG00000058420 |1   | 190.002808|   6.531293| 135.481336| 191.89737|
|ENSMUSG00000026637 |1   | 192.137668|  13.183821| 191.655992| 192.51205|
|ENSMUSG00000019945 |2   |  72.077418|   6.609965|  17.713445| 169.28966|
|ENSMUSG00000081046 |2   | 129.184651|   6.497957|  12.915206| 135.45041|
|ENSMUSG00000097283 |2   | 153.419672|   8.793228| 150.991127| 153.83765|
|ENSMUSG00000027487 |2   | 156.136279|   6.608979| 154.085478| 156.75363|
|ENSMUSG00000027487 |2   | 161.576254|   7.091103| 161.309135| 162.89119|
|ENSMUSG00000054455 |2   | 165.445995|   8.888555| 163.582672| 166.47560|
|ENSMUSG00000097283 |2   | 178.833418|  30.515193| 176.416737| 178.90319|
|ENSMUSG00000027718 |3   |  33.606276|  31.217791|  32.304940|  33.65661|
|ENSMUSG00000027718 |3   |  37.165286|  75.126515|  36.852209|  37.32921|
|ENSMUSG00000027722 |3   |  37.374870|   6.214390|  34.262328| 114.46680|
|ENSMUSG00000048416 |3   |  67.791179|   7.134414|  66.785770|  73.56933|
|ENSMUSG00000000340 |3   | 114.948141|   9.484962| 111.607392| 114.97076|
|ENSMUSG00000037994 |3   | 135.232817|  49.079161| 135.232817| 135.23282|
|ENSMUSG00000021127 |4   |   3.798433|   6.132635|   3.000000| 149.94046|
|ENSMUSG00000070980 |4   |  54.766817|  11.218926|  54.527023|  55.60324|
|ENSMUSG00000096177 |4   |  65.427487|   8.792047|  63.528309|  78.76958|
|ENSMUSG00000033389 |4   | 111.238045|   6.214717| 109.522381| 116.12848|
|ENSMUSG00000050854 |4   | 118.471245|  35.618326| 118.397472| 118.54342|
|ENSMUSG00000029804 |4   | 143.211132|   6.035045| 138.750051| 148.34659|
|ENSMUSG00000029321 |4   | 154.874097|   6.069940|  20.129417| 156.21626|
|ENSMUSG00000081046 |5   |  98.997378|   6.773936|  92.854978| 103.17849|
|ENSMUSG00000029321 |5   | 103.614608|  21.562401| 103.586587| 105.67241|
|ENSMUSG00000099095 |5   | 108.046168|   6.777903| 102.956536| 112.75631|
|ENSMUSG00000032305 |6   |  37.349577|   6.720697|  16.376879|  48.92068|
|ENSMUSG00000071519 |6   |  41.406513|  17.315115|  40.920539|  41.40651|
|ENSMUSG00000002797 |6   |  54.997148|  39.222855|  54.855033|  55.18362|
|ENSMUSG00000029804 |6   |  58.488862|   8.546978|  40.993625|  60.76170|
|ENSMUSG00000089634 |6   |  86.133168|  11.672479|  85.420854|  86.55060|
|ENSMUSG00000048416 |6   | 125.226964|   6.154786|  45.277826| 125.94593|
|ENSMUSG00000031532 |6   | 125.553788|   6.312708|  63.210018| 126.65001|
|ENSMUSG00000070980 |6   | 127.078807|   6.130341| 126.722486| 135.05159|
|ENSMUSG00000080968 |6   | 133.867522|   6.004287| 129.390996| 139.21454|
|ENSMUSG00000015112 |6   | 134.185817|   6.123813| 129.110159| 135.65721|
|ENSMUSG00000070980 |6   | 145.839910|   6.202777| 145.391545| 146.31853|
|ENSMUSG00000025557 |7   |  36.613646|   6.506206|  35.767556| 133.15669|
|ENSMUSG00000038738 |7   |  44.445619|  19.010804|  43.844466|  44.86733|
|ENSMUSG00000080383 |7   |  57.912994|   6.407887|  50.696529| 101.62734|
|ENSMUSG00000058420 |7   | 118.237771|  29.916509| 117.782005| 118.45922|
|ENSMUSG00000021676 |8   |  22.086620|   6.149473|  18.457359| 115.32557|
|ENSMUSG00000031532 |8   |  33.827024|  17.787609|  33.095603|  34.20777|
|ENSMUSG00000002797 |8   |  95.702894|   6.560175|  94.937120| 103.87985|
|ENSMUSG00000049307 |9   |  14.764262| 117.447471|  14.703558|  14.84658|
|ENSMUSG00000054455 |9   |  27.198455|   7.336424|  20.908490| 110.55064|
|ENSMUSG00000097554 |9   |  41.186050|  28.140130|  40.780764|  41.20384|
|ENSMUSG00000039542 |9   |  49.615275|  75.098477|  49.494008|  50.10869|
|ENSMUSG00000038738 |9   |  50.108691|   6.657000|  49.051211|  78.22393|
|ENSMUSG00000038086 |9   |  51.898259|   9.842327|  51.472947|  52.50449|
|ENSMUSG00000032305 |9   |  57.362395|  14.166389|  57.359763|  57.96257|
|ENSMUSG00000039542 |9   |  58.357965|  24.965759|  58.264792|  58.51857|
|ENSMUSG00000026637 |9   |  66.202095|   6.128876|  61.127900| 118.85930|
|ENSMUSG00000039542 |9   | 107.647626|   6.709880| 103.046146| 108.28455|
|ENSMUSG00000032305 |9   | 117.664006|   7.429687| 116.937976| 118.80569|
|ENSMUSG00000044795 |10  |  22.909158|   7.195228|  21.125750|  23.14018|
|ENSMUSG00000019945 |10  |  68.436555|  36.340070|  68.296752|  68.55129|
|ENSMUSG00000019945 |10  |  68.966184|  32.570583|  68.966184|  69.22692|
|ENSMUSG00000071519 |10  |  75.574081|   6.462753|  73.705382|  83.04843|
|ENSMUSG00000029321 |10  | 125.591103|   7.538025| 125.539735| 126.86601|
|ENSMUSG00000080968 |11  |  16.903986|   6.044069|   9.065479|  41.96490|
|ENSMUSG00000069910 |11  |  34.822220|  26.757661|  34.701511|  34.82222|
|ENSMUSG00000033389 |11  |  65.063246|   9.777574|  64.648612|  68.88967|
|ENSMUSG00000041189 |11  |  67.078257|   6.065475|  64.368932|  70.61624|
|ENSMUSG00000044795 |11  |  68.892129|  10.613848|  65.096598|  69.41636|
|ENSMUSG00000027722 |11  |  73.111862|   6.349757|  73.005652|  77.67011|
|ENSMUSG00000039542 |11  |  78.151256|   6.402459|   5.561303| 105.51410|
|ENSMUSG00000027718 |11  |  79.152432|   6.886785|  70.782062|  82.07630|
|ENSMUSG00000051452 |11  |  84.107102|  10.077904|  83.647144|  84.68618|
|ENSMUSG00000025557 |11  |  98.275118|   6.140239|  90.223909|  99.34041|
|ENSMUSG00000080383 |11  | 109.423954|  11.546496| 109.406840| 111.19709|
|ENSMUSG00000027487 |12  |   6.347016|   6.708630|   5.846368|  11.34456|
|ENSMUSG00000033373 |12  |  76.788953|  32.214804|  76.548097|  76.88841|
|ENSMUSG00000021127 |12  |  83.238468|   6.982385|  82.129546|  86.61000|
|ENSMUSG00000058420 |12  |  84.148297|   6.072393|  80.160035| 117.40074|
|ENSMUSG00000021271 |12  |  87.166517|   6.136045|  56.572766|  88.46608|
|ENSMUSG00000049307 |12  | 107.833410|   6.639038| 106.974113| 109.52447|
|ENSMUSG00000021271 |12  | 110.197950|  33.653196| 110.180714| 111.45223|
|ENSMUSG00000099095 |13  |  15.611917|   8.154411|  13.283182|  18.32901|
|ENSMUSG00000015112 |13  |  35.457506|   6.362942|  34.416849| 105.15802|
|ENSMUSG00000027487 |13  |  64.344624|   9.185658|  63.548321|  67.69218|
|ENSMUSG00000097283 |13  |  65.206454|  10.783729|  64.841763|  66.93469|
|ENSMUSG00000021676 |13  |  95.733655| 100.243082|  95.733655|  95.85903|
|ENSMUSG00000069910 |13  | 101.786348|   6.927969| 101.137104| 102.83022|
|ENSMUSG00000050854 |14  |  31.435803|   6.178650|  28.932629|  94.70510|
|ENSMUSG00000086341 |14  |  48.126291|   7.138599|  46.678372|  51.99293|
|ENSMUSG00000025557 |14  |  99.566266|   6.659106|  13.014489| 101.18782|
|ENSMUSG00000025557 |14  | 121.571691|  35.458616| 121.480418| 121.67373|
|ENSMUSG00000022292 |15  |  38.227976|   7.784003|  36.256559|  41.45437|
|ENSMUSG00000015112 |15  |  58.990004|   7.527785|  58.658042|  60.07672|
|ENSMUSG00000060487 |15  |  60.990009|   6.909902|  58.857152|  67.06317|
|ENSMUSG00000022292 |15  |  64.643518|   6.404510|  62.181647|  72.90648|
|ENSMUSG00000024085 |15  |  66.679768|   7.227881|  63.659243|  68.92043|
|ENSMUSG00000080968 |15  | 100.424363|  59.731554|  99.800294| 100.43483|
|ENSMUSG00000026637 |16  |  94.789233|   6.874482|   3.000000|  94.97204|
|ENSMUSG00000015112 |17  |  43.242630|   7.536525|  34.179599|  43.56276|
|ENSMUSG00000024085 |17  |  64.655048|  55.404509|  64.600441|  64.72895|
|ENSMUSG00000069910 |17  |  69.244748|   6.998414|  68.506902|  70.46603|
|ENSMUSG00000086219 |17  |  78.830855|   7.823507|  77.910515|  80.14648|
|ENSMUSG00000070980 |17  |  89.875434|   6.190791|  78.362313|  94.98443|
|ENSMUSG00000032305 |18  |  68.177134|   6.075548|  65.041330|  68.20743|
|ENSMUSG00000002797 |19  |  38.421678|   6.062762|  36.662639|  40.14056|
|ENSMUSG00000044795 |19  |  40.204814|   6.610261|  38.774165|  40.22262|
|ENSMUSG00000021676 |X   |  12.322085|   7.621003|  11.895188|  12.99006|
|ENSMUSG00000086219 |X   |  49.017962|   7.209342|  48.174569|  50.20412|
|ENSMUSG00000009079 |X   |  53.140129|   7.474459|  51.892232|  59.08406|
|ENSMUSG00000067878 |X   |  56.774258|  16.144863|  53.969865|  56.80714|
|ENSMUSG00000015112 |X   | 150.513256|  10.317359| 145.335742| 157.49709|
|ENSMUSG00000058420 |X   | 153.682008|   7.479411| 146.728544| 163.71076|
|ENSMUSG00000022292 |X   | 158.566592|   6.854800| 155.383862| 160.34933|
|ENSMUSG00000071519 |X   | 166.335626|   8.361242| 164.415283| 167.22935|

### QTL Peaks Figure


~~~
qtl_heatmap(qtl = qtl, map = map, low.thr = 3.5)
~~~
{: .language-r}

<img src="../fig/rmd-06-qtl_heatmap-1.png" alt="plot of chunk qtl_heatmap" width="612" style="display: block; margin: auto;" />

> ## Challenge
> What do the qtl scans for all gene exression traits look like? *Note:* Don't worry, we've done the qtl scans for you!!!
> You can read in this file, `../data/gene.norm_qtl_all.genes.Rdata`, which are the `scan1` results for all gene expression traits. 
>
> > ## Solution
> > 
> > 
> > ~~~
> > load("../data/gene.norm_qtl_all.genes.Rdata")
> > 
> > lod_threshold = 6
> > peaks = find_peaks(scan1_output = qtl, 
> >                map = map, 
> >                threshold = lod_threshold, 
> >                peakdrop = 4, 
> >                prob = 0.95)
> > write_csv(peaks, "../results/gene.norm_qtl_all.genes_peaks.csv")
> > 
> > ## Heat Map
> > qtl_heatmap(qtl = qtl, map = map, low.thr = 3.5)
> > ~~~
> > {: .language-r}
> {: .solution}
{: .challenge}
